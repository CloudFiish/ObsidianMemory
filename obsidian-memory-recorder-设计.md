# 记录技能设计

## 技能名称
`obsidian-memory-recorder`

## 核心功能
将对话内容自动记录到 Obsidian Bases 记忆系统中，支持多种记录方式。

## 使用场景

### 场景 1: 对话中实时记录
**用户说**："记录一下，我们刚才讨论了使用 PostgreSQL 作为数据库"
**技能动作**:
1. 自动提取关键信息
2. 生成标题："数据库选择 - PostgreSQL"
3. 自动设置标签：#技术, #决策
4. 设置重要程度：4 星（技术决策默认高优先级）
5. 创建每日日志文件

### 场景 2: 结构化记录
**用户提供**:
```
标题: API 设计完成
类型: 决策
内容: 选择 REST API，理由是...
重要程度: 5
相关项目: Acme Dashboard
```
**技能动作**:
1. 验证必填字段
2. 创建标准化记录
3. 返回记录位置

### 场景 3: 快捷记录
**用户说**："记录这条决策：使用 TypeScript 开发前端"
**技能动作**:
1. 识别"决策"关键字
2. 提取决策内容
3. 自动分类
4. 快速创建记录

## 记录流程

```
用户输入
    ↓
识别记录模式（实时/结构化/快捷）
    ↓
提取关键信息
    ↓
验证和补充
    ↓
生成 YAML frontmatter
    ↓
创建/更新笔记文件
    ↓
返回记录结果
```

## 字段自动填充规则

### 标题生成
- 决策类："类型 - 核心内容"
- 会议类："会议 - 参与者/主题"
- 学习类："学习 - 技术名称/主题"
- 默认：提取前 20 个字符

### 标签推断
```python
关键词映射 = {
    "数据库": ["#技术", "#数据库"],
    "API": ["#技术", "#API"],
    "决策": ["#技术", "#决策"],
    "会议": ["#会议"],
    "学习": ["#学习"],
    "重要": ["#重要"]
}
```

### 重要程度规则
```python
优先级规则 = {
    "决策": 4,
    "重要": 5,
    "完成": 3,
    "讨论": 3,
    "学习": 3,
    "默认": 3
}
```

### 类型推断
```python
类型映射 = {
    "决定": "决策",
    "选择": "决策",
    "会议": "会议记录",
    "学习": "学习笔记",
    "记录": "每日日志",
    "默认": "每日日志"
}
```

## 记录命令

### 命令 1: 记录当前对话
```
/record [内容]
```
**示例**:
```
/record 我们决定使用 PostgreSQL 作为数据库，因为它的 ACID 特性
```

### 命令 2: 结构化记录
```
/record-struct
<等待用户输入结构化数据>
```

### 命令 3: 快捷记录决策
```
/decision [决策内容]
```
**示例**:
```
/decision 使用 REST API
```

### 命令 4: 快捷记录会议
```
/meeting [主题] [参与者]
```
**示例**:
```
/meeting API 设计 Alice, Bob, Charlie
```

## 输出格式

### 成功输出
```
✓ 记录已创建
📁 文件: memory/2026-02-02.md
📝 标题: 数据库选择 - PostgreSQL
🏷️  标签: #技术, #决策, #重要
⭐ 重要程度: 4⭐
🔗 相关项目: 未指定

查看记录: [[memory/2026-02-02.md]]
```

### 错误输出
```
❌ 记录失败
原因: 缺少必要信息
提示: 请提供标题或内容
```

## 交互流程

### 模式 1: 对话记录
```
用户: 记录这个讨论，我们选择了 PostgreSQL
AI: [自动识别记录意图]

[提取信息]
- 标题: 数据库选择 - PostgreSQL
- 内容: 讨论并选择了 PostgreSQL 作为数据库
- 类型: 决策
- 标签: #技术, #决策
- 重要程度: 4⭐

[确认信息]
请确认记录信息：
✓ 标题: 数据库选择 - PostgreSQL
✓ 类型: 决策
✓ 重要程度: 4⭐
✓ 标签: #技术, #决策

修改建议：
- [1] 修改标题
- [2] 修改重要程度
- [3] 添加标签
- [4] 确认创建

用户: 4
AI: ✓ 记录已创建到 memory/2026-02-02.md
```

### 模式 2: 结构化记录
```
用户: /record-struct
AI: [显示结构化表单]

请填写以下信息（必填项用 * 标记）：

标题*: [输入]
类型*: [选择：每日日志/决策/任务/学习笔记]
内容*: [输入]
标签: [选择：#技术 #决策 #学习]
重要程度: [1-5 星]
相关项目: [可选]
状态: [选择：进行中/已完成/暂停]

用户: 标题: API 设计完成
      类型: 决策
      内容: 选择 REST API
      ...

AI: ✓ 记录已创建
```

## 错误处理

### 错误类型
1. **路径不存在**: 提示检查 Obsidian 路径
2. **权限不足**: 提示检查文件权限
3. **格式错误**: 提示修正 YAML 格式
4. **缺少必填**: 提示填写必填字段

### 重试机制
```
记录失败
    ↓
分析失败原因
    ↓
提供修正建议
    ↓
等待用户修正
    ↓
自动重试
```

## 与记忆系统集成

### 依赖
- 需要先创建记忆系统（使用 obsidian-bases-memory skill）
- 读取配置文件获取字段定义
- 验证标签和类型的合法性

### 配置文件位置
```
~/.obsidian-bases-memory/config.json
{
  "vault_path": "/path/to/vault",
  "daily_log_folder": "memory",
  "long_term_file": "MEMORY.md"
}
```

## 扩展功能

### 功能 1: 批量记录
支持一次记录多条内容

### 功能 2: 模板选择
选择不同的记录模板

### 功能 3: 自动关联
自动关联到相关项目和之前的决策

### 功能 4: 语音记录
支持语音输入转换为文本记录

## 配置选项

```json
{
  "auto_title_generation": true,
  "auto_tag_inference": true,
  "default_importance": 3,
  "require_confirmation": true,
  "auto_open_after_create": true
}
```
