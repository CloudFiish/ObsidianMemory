---
name: obsidian-memory-manager
description: Obsidian 记忆系统统一调度管理器 - 智能协调记忆系统的初始化、记录和检索操作。当用户提到"记忆系统"、"记录"、"搜索记忆"、"查找历史"、"初始化记忆"等关键词时自动触发。提供统一的配置管理和智能判断功能，自动决定何时初始化系统、何时记录信息、何时检索历史。
---

# Obsidian 记忆系统统一调度管理器

## 概述

这是一个**统一调度技能**，负责智能协调 Obsidian 记忆系统的三个核心组件：
- **obsidian-bases-memory**: 基础设施初始化
- **obsidian-memory-recorder**: 信息记录
- **obsidian-memory-retriever**: 记忆检索

## 核心功能

1. **自动初始化记忆系统** - 检测并自动创建必要的数据结构
2. **智能判断何时记录/检索** - 基于用户意图自动选择合适的操作
3. **提供统一的命令接口** - 简化的命令体系，统一配置管理

## 触发条件

当用户提到以下关键词时自动触发：
- 记忆系统相关："记忆系统"、"初始化记忆"、"设置记忆"
- 记录相关："记录一下"、"保存"、"记下来"、"写进记忆"
- 检索相关："搜索记忆"、"查找历史"、"回顾"、"之前说过"
- 管理相关："记忆配置"、"系统状态"、"记忆设置"

## 统一配置管理

### 配置文件位置

`assets/config/manager_config.json`

### 配置结构

```json
{
  "vault_path": "<Obsidian库路径>",
  "auto_initialize": true,
  "auto_detect_intent": true,
  "components": {
    "bases_memory": {
      "enabled": true,
      "path": "obsidian-bases-memory"
    },
    "recorder": {
      "enabled": true,
      "path": "obsidian-memory-recorder",
      "auto_record_keywords": ["决定", "选择", "偏好", "重要"]
    },
    "retriever": {
      "enabled": true,
      "path": "obsidian-memory-retriever",
      "default_search_mode": "hybrid"
    }
  },
  "memory_rules": {
    "min_importance_for_summary": 3,
    "auto_sync_to_memory_md": ["决策", "用户偏好"],
    "retention_days": 365
  }
}
```

## 智能执行流程

### 第一步：系统状态检测

触发技能后，首先检测记忆系统的状态：

1. **检查配置文件** - 读取 `manager_config.json`
2. **检查基础设施** - 验证 `memory/` 目录和 `MEMORY.md` 是否存在
3. **确定当前状态**:
   - `未初始化` - 需要执行初始化
   - `已初始化但未配置` - 需要更新配置
   - `完全就绪` - 可直接执行操作

### 第二步：意图识别

基于用户输入，智能判断用户意图：

| 用户输入特征 | 识别意图 | 执行操作 |
|-------------|---------|---------|
| "初始化"、"设置"、"第一次用" | 系统初始化 | 调用 bases-memory |
| "记录"、"保存"、"记下来" | 信息记录 | 调用 recorder |
| "搜索"、"查找"、"回顾"、"之前" | 记忆检索 | 调用 retriever |
| "配置"、"设置"、"修改" | 配置管理 | 更新配置文件 |
| 陈述重要决策/偏好（无明确指令） | 智能记录 | 询问确认后调用 recorder |

### 第三步：执行操作

根据识别的意图，执行相应的操作：

#### 场景 A: 系统初始化

```
用户: "初始化记忆系统"

检测状态 → 发现未初始化
    ↓
询问: "检测到记忆系统未初始化，是否在 [路径] 初始化？"
    ↓
用户确认
    ↓
执行:
  1. 调用 bases-memory 创建基础设施
  2. 生成默认配置文件
  3. 验证初始化结果
    ↓
反馈: "✅ 记忆系统初始化完成"
```

#### 场景 B: 智能记录

```
用户: "我决定使用 PostgreSQL 作为数据库"

意图识别 → 检测到决策陈述
    ↓
询问: "检测到重要决策，是否记录到记忆系统？"
    ↓
用户确认
    ↓
执行:
  1. 分析内容（类型: 决策, 重要程度: 4⭐）
  2. 调用 recorder 写入 memory/{Date}.md
     格式: 每条记录独立的属性表格
  3. 同步更新 MEMORY.md
    ↓
反馈: "✅ 已记录决策到 [[memory/2026-02-04.md#14-30-决策-PostgreSQL]]"
```

**记录格式示例**:
```markdown
### 14:30 - 决策 - PostgreSQL

| 属性 | 值 |
|------|-----|
| 类型 | 决策 |
| 重要程度 | 4⭐ |
| 项目 | 电商平台 |
| 状态 | 进行中 |

决定使用 PostgreSQL 作为数据库...
```

#### 场景 C: 记忆检索

```
用户: "搜索之前关于数据库的讨论"

意图识别 → 检索请求
    ↓
询问搜索模式:
  [1] 关键词搜索
  [2] 语义搜索
  [3] 混合搜索 ← 推荐
    ↓
用户选择
    ↓
执行:
  1. 调用 retriever 执行搜索
  2. 格式化结果
    ↓
反馈: 显示搜索结果列表
```

## 统一命令接口

### 快捷命令

```bash
# 系统管理
/memory init              # 初始化记忆系统
/memory status            # 查看系统状态
/memory config            # 编辑配置

# 记录操作
/memory record            # 记录信息（交互式）
/memory decision          # 快速记录决策
/memory meeting           # 快速记录会议
/memory learn             # 快速记录学习笔记

# 检索操作
/memory search <关键词>    # 关键词搜索
/memory find <查询>        # 混合搜索
/memory today             # 查看今日记录
/memory this-week         # 查看本周记录
/memory important         # 查看重要记录

# 快捷方式
/remember                 # 等同于 /memory record
/recall                   # 等同于 /memory find
```

### 自然语言支持

支持自然语言触发，无需记忆特定命令：

```
"帮我记录一下这个决定"
"搜索之前关于 API 的讨论"
"查看本周的重要事项"
"初始化我的记忆系统"
```

## 智能特性

### 1. 自动初始化检测

- 首次使用时自动检测系统状态
- 如果发现基础设施缺失，主动提示初始化
- 支持一键初始化，无需手动调用多个技能

### 2. 意图自动识别

- 分析用户输入的语义
- 自动判断是记录还是检索需求
- 对于模糊请求，智能推荐最合适的操作

### 3. 上下文感知

- 维护对话上下文
- 理解指代关系（"刚才说的"、"那个决定"）
- 支持连续操作（"再记录一条"、"继续搜索"）

### 4. 智能推荐

- 根据历史记录推荐相关记忆
- 提醒未完成的决策或任务
- 建议归档或清理过期记录

## 配置管理

### 查看当前配置

```bash
/memory config show
```

### 修改配置

```bash
/memory config set vault_path "D:\\MyNotes"
/memory config set auto_initialize true
```

### 重置配置

```bash
/memory config reset
```

## 与其他技能的关系

```
obsidian-memory-manager (调度层)
        ↓
    ┌───┴───┐
    ↓       ↓       ↓
  bases   recorder  retriever
  (基础)   (记录)    (检索)
```

**注意**: 本技能不替代原有的三个技能，而是作为它们的统一调度和管理层。原有的技能仍然可以独立使用。

## 工作流程示例

### 完整使用流程

```
用户: "我想开始使用记忆系统"

AI: [触发 manager 技能]
    检测到系统未初始化
    
AI: "检测到记忆系统尚未初始化。我可以在 D:\JF\Note\ObsidianMemory 为您初始化吗？"

用户: "好的"

AI: [执行初始化]
    1. 创建 memory/ 目录
    2. 创建 MEMORY.md
    3. 创建 记忆数据库.base
    4. 生成默认配置
    
AI: "✅ 记忆系统初始化完成！您现在可以：
    - 说'记录'来保存信息
    - 说'搜索'来查找历史记录"

---

用户: "我决定使用 Python 作为主要开发语言"

AI: [触发 manager 技能]
    意图识别: 决策陈述
    
AI: "检测到重要决策。是否记录到记忆系统？"

用户: "是的"

AI: [执行记录]
    类型: 决策
    重要程度: 4⭐
    
AI: "✅ 已记录决策到 [[memory/2026-02-04.md]]，并已同步到 MEMORY.md"

---

用户: "搜索之前的技术决策"

AI: [触发 manager 技能]
    意图识别: 检索请求
    
AI: "请选择搜索模式：
    [1] 关键词搜索
    [2] 语义搜索
    [3] 混合搜索 ← 推荐"

用户: "3"

AI: [执行混合搜索]
    查询: "技术决策"
    结果: 找到 2 条记录
    
AI: "🔍 找到 2 条相关记录：
    [1] ⭐⭐⭐⭐ 使用 Python 作为主要开发语言
    [2] ⭐⭐⭐⭐ 选择 PostgreSQL 作为数据库"
```

## 故障排查

### 系统未初始化

**现象**: 提示 "记忆系统未初始化"
**解决**: 执行 `/memory init` 或说 "初始化记忆系统"

### 配置错误

**现象**: 无法找到 Obsidian 库路径
**解决**: 执行 `/memory config set vault_path "<正确路径>"`

### 权限问题

**现象**: 无法写入文件
**解决**: 检查目录权限，或更换 Obsidian 库路径

## 最佳实践

1. **首次使用先初始化** - 确保基础设施完整
2. **善用自动记录** - 让系统自动检测重要信息
3. **定期回顾** - 使用 `/memory this-week` 回顾近期记录
4. **保持配置更新** - 根据使用习惯调整配置
5. **结合自然语言** - 不需要记忆复杂命令，直接描述需求

## 总结

obsidian-memory-manager 提供了：

✅ **统一入口** - 一个技能管理所有记忆操作  
✅ **智能调度** - 自动判断何时初始化、记录、检索  
✅ **简化操作** - 自然语言支持，无需记忆复杂命令  
✅ **统一配置** - 集中管理所有配置项  
✅ **向后兼容** - 原有技能仍可独立使用  

开始使用：
1. 说 "初始化记忆系统"
2. 说 "记录..." 保存信息
3. 说 "搜索..." 查找历史
