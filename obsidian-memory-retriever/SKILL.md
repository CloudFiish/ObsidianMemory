---
name: obsidian-memory-retriever
description: Obsidian 检索技能 - 当用户需要"搜索记忆"、"查找记录"、"检索信息"、"搜索历史"、"回顾决策"时触发。支持三种搜索模式：(1)关键词搜索 - 精确匹配标题、内容、标签；(2)语义搜索 - 理解语义含义，查找相关概念；(3)混合搜索 - 结合关键词和语义，加权排序。支持丰富的过滤条件（日期、类型、重要程度、状态、项目）和灵活的排序选项。触发后将询问用户搜索模式、查询内容和过滤条件，返回格式化的搜索结果。
---

# Obsidian 检索技能

## 概述

这个 skill 帮助你在 Obsidian Bases 记忆系统中智能检索信息，支持多种搜索方式和丰富的过滤条件。

**核心功能**:
- 关键词搜索，精确匹配
- 语义搜索，理解概念
- 混合搜索，加权排序
- 丰富的过滤条件
- 灵活的排序选项

## 用户交互流程

### 问题 1: 选择搜索模式

```
请选择搜索模式：

[1] 关键词搜索
    精确匹配标题、内容、标签
    适合: 搜索具体术语、名称、ID

[2] 语义搜索
    理解语义含义，查找相关概念
    适合: 自然语言查询、概念搜索、同义词匹配

[3] 混合搜索
    结合关键词和语义，加权排序
    适合: 综合查询、需要高准确度、不确定最佳方法

请选择 [1-3]:
```

### 问题 2: 输入搜索查询

根据选择的模式，输入查询内容：

#### 模式 1: 关键词搜索
```
请输入搜索关键词：

示例：
- "PostgreSQL"
- "API 设计"
- "数据库选择"
```

#### 模式 2: 语义搜索
```
请输入自然语言查询：

示例：
- "我们之前讨论过数据库选择吗？"
- "重要的技术决策有哪些？"
- "关于 API 的讨论"
```

#### 模式 3: 混合搜索
```
请输入查询内容：

示例：
- "找到技术决策，特别是关于 API 的"
- "本周的重要事项"
- "数据库相关的讨论"
```

### 问题 3: 设置过滤条件（可选）

```
是否需要设置过滤条件？

[1] 按日期过滤
[2] 按类型过滤
[3] 按重要程度过滤
[4] 按状态过滤
[5] 按项目过滤
[6] 不需要过滤

请选择 [1-6]:
```

#### 日期过滤选项
```
选择日期过滤类型：

[1] 今天
[2] 本周
[3] 本月
[4] 指定日期
[5] 日期范围（之后）
[6] 日期范围（之前）

请选择 [1-6]:
```

#### 类型过滤选项
```
选择记录类型：

[1] 每日日志
[2] 决策
[3] 任务
[4] 学习笔记
[5] 会议记录
[6] 用户偏好

请选择 [1-6]:
```

#### 重要程度过滤选项
```
选择最小重要程度：

[1] 4 星及以上（重要）
[2] 5 星（紧急）
[3] 不限制

请选择 [1-3]:
```

#### 状态过滤选项
```
选择记录状态：

[1] 进行中
[2] 已完成
[3] 暂停
[4] 已归档
[5] 不限制

请选择 [1-5]:
```

### 问题 4: 选择排序方式

```
选择排序方式：

[1] 按相关性排序（默认）
[2] 按日期降序
[3] 按日期升序
[4] 按重要程度降序
[5] 按重要程度升序

请选择 [1-5]:
```

## 快速开始

### 方法 1: 使用脚本

**关键词搜索**:
```bash
python scripts/search.py <笔记库路径> <关键词> [选项]
```

**语义搜索**:
```bash
python scripts/semantic_search.py <笔记库路径> <查询> [选项]
```

**混合搜索**:
```bash
python scripts/hybrid_search.py <笔记库路径> <查询> [选项]
```

### 方法 2: 使用快捷命令

在支持命令的环境中直接使用：

```bash
# 关键词搜索
/search PostgreSQL
/search 决策

# 语义搜索
/semantic 我们之前讨论过数据库吗？

# 混合搜索
/find 技术决策，特别是关于 API 的
```

### 方法 3: 快捷过滤

```bash
# 快捷过滤器
/today           # 今天的记录
/this-week       # 本周的记录
/important       # 高优先级（4星以上）
/pending         # 进行中的任务

# 组合使用
/this-week /important /decision
```

## 搜索模式详解

### 模式 1: 关键词搜索

**特点**:
- 精确匹配关键词
- 支持标题、内容、标签匹配
- 不同位置不同权重
- 快速高效

**权重规则**:
- 标题匹配: 10 分
- 内容匹配: 5 分
- 标签匹配: 3 分

**适用场景**:
- 搜索具体术语
- 查找精确匹配
- 搜索名称或ID

**脚本**: `scripts/search.py`

详见: [search_algorithms.md](references/search_algorithms.md)

### 模式 2: 语义搜索

**特点**:
- 理解语义含义
- 支持同义词匹配
- 使用嵌入向量
- 余弦相似度计算

**算法**:
```python
# 1. 生成嵌入向量
query_embedding = model.encode(query)
record_embedding = model.encode(record)

# 2. 计算相似度
similarity = cosine_similarity(query_embedding, record_embedding)

# 3. 过滤和排序
if similarity >= threshold:
    results.append((record, similarity))
```

**适用场景**:
- 自然语言查询
- 概念和想法搜索
- 关键词不完全匹配

**脚本**: `scripts/semantic_search.py`

详见: [search_algorithms.md](references/search_algorithms.md)

### 模式 3: 混合搜索

**特点**:
- 结合关键词和语义
- 加权计算总分
- 最佳准确性
- 灵活权重调整

**权重配置**:
```python
keyword_weight = 0.3   # 关键词权重 30%
semantic_weight = 0.7   # 语义权重 70%

# 计算总分
total_score = (keyword_weight * normalized_keyword) + \
             (semantic_weight * normalized_semantic)
```

**适用场景**:
- 综合查询
- 需要高准确度
- 初期不确定最佳方法

**脚本**: `scripts/hybrid_search.py`

详见: [search_algorithms.md](references/search_algorithms.md)

## 过滤条件

### 日期过滤

#### 快捷过滤器
```bash
/today           # 今天
/this-week       # 本周
/this-month      # 本月
```

#### 脚本选项
```bash
--date 2026-02-02       # 指定日期
--after 2026-01-01       # 日期之后
--before 2026-12-31      # 日期之前
```

### 类型过滤

```bash
--type decision    # 仅决策
--type meeting    # 仅会议
--type learn      # 仅学习笔记
```

### 重要程度过滤

```bash
--importance 4   # 4 星及以上
/important         # 快捷命令
/urgent           # 5 星
```

### 状态过滤

```bash
--status 进行中
/pending          # 快捷命令
/completed        # 快捷命令
```

### 项目过滤

```bash
--project "Acme Dashboard"
/project <项目名>  # 快捷命令
```

详见: [filter_guide.md](references/filter_guide.md) 完整指南。

## 输出格式

### 简洁格式
```
🔍 找到 3 条相关记录

[1] ⭐⭐⭐⭐ 数据库选择 - PostgreSQL
    📅 2026-01-15 | 🏷️ #技术 #决策

[2] ⭐⭐⭐ API 设计 - REST 选择
    📅 2026-01-20 | 🏷️ #技术 #决策
```

### 详细格式
```
============================================================
🔍 搜索结果（共 3 条）
============================================================

[1] ⭐⭐⭐⭐ 数据库选择 - PostgreSQL
    📁 文件: 2026-01-15.md
    📅 日期: 2026-01-15 | ⏰ 时间: 14:30
    🏷️ 类型: 决策 | 标签: #技术 #决策
    ⭐ 重要程度: 4 | 🔗 项目: Acme Dashboard
    📊 状态: 已完成
    📄 摘要: 决策: 选择 PostgreSQL 作为数据库...

============================================================
```

### 表格格式
```
序号  标题                          日期         类型       重要
------------------------------------------------------------
1      数据库选择 - PostgreSQL      2026-01-15  决策      4⭐
2      API 设计 - REST 选择         2026-01-20  决策      4⭐
```

详见: [result_format.md](references/result_format.md) 完整指南。

## 排序选项

| 排序方式 | 说明 | 使用场景 |
|----------|------|----------|
| 相关性 | 按搜索相关性排序 | 默认排序 |
| 日期降序 | 最新的在前 | 时间线查看 |
| 日期升序 | 最旧的在前 | 历史回顾 |
| 重要程度降序 | 最重要的在前 | 优先处理 |
| 重要程度升序 | 最不重要的在前 | 优先级管理 |

## 参考文档

### [search_algorithms.md](references/search_algorithms.md)

详细的搜索算法说明。

**内容包括**:
- 关键词搜索算法
- 语义搜索算法
- 混合搜索算法
- 嵌入模型选择
- 相似度计算
- 性能优化

### [filter_guide.md](references/filter_guide.md)

完整的过滤器使用指南。

**内容包括**:
- 所有可用过滤器
- 过滤器操作符
- 组合过滤器
- 快捷过滤器
- 常见使用场景

### [result_format.md](references/result_format.md)

结果格式化指南。

**内容包括**:
- 输出格式规范
- 分数显示
- 摘要生成
- 无结果处理
- 操作选项
- 导出格式

## 资产文件

### [retriever_config.json](assets/config/retriever_config.json)

完整的配置文件。

**配置项**:
- 搜索模式设置
- 输出格式配置
- 过滤器配置
- 排序选项
- 嵌入模型配置
- 性能优化配置
- UI 配置

## 工作流程

### 完整搜索流程

```
用户触发技能
    ↓
选择搜索模式（1/2/3）
    ↓
输入查询内容
    ↓
设置过滤条件（可选）
    ↓
选择排序方式（可选）
    ↓
执行搜索
    ↓
格式化结果
    ↓
显示结果
    ↓
提供操作选项
```

### 交互式搜索流程

```
用户: 查找 PostgreSQL 相关的记录
AI: [触发 skill]

选择搜索模式:
[1] 关键词搜索 ← 用户选择

请输入搜索关键词:
用户: PostgreSQL

是否需要设置过滤条件？
用户: 否

选择排序方式:
[1] 按相关性排序 ← 用户选择

🔍 搜索 "PostgreSQL"...

找到 3 条相关记录

[1] ⭐⭐⭐⭐ 数据库选择 - PostgreSQL
[2] ⭐⭐ 技术选型 - Redis
[3] ⭐ 学习了 PostgreSQL 特性

操作选项:
[1] 查看记录 1
[2] 查看记录 2
[3] 查看记录 3
[n] 新建搜索
[q] 退出

用户: 1
AI: ✓ 打开记录: [[2026-01-15.md]]
```

## 常见问题

### Q: 什么时候使用哪种搜索模式？

A:
- **关键词搜索**: 搜索具体术语、名称、ID
- **语义搜索**: 自然语言查询、概念搜索
- **混合搜索**: 综合查询、需要高准确度

### Q: 如何组合使用过滤条件？

A: 可以同时使用多个过滤器，例如：
```bash
python hybrid_search.py ~/Obsidian/Vault "" \
  --type 决策 \
  --importance 4 \
  --this-week
```

### Q: 为什么有些记录没有出现？

A: 检查：
1. 过滤条件是否太严格
2. 搜索模式是否适合查询
3. 尝试使用语义搜索
4. 查看结果数量限制

### Q: 如何提高搜索准确性？

A:
1. 使用混合搜索
2. 调整关键词和语义权重
3. 使用过滤条件缩小范围
4. 尝试不同的查询词

### Q: 语义搜索为什么结果少？

A: 检查：
1. 相似度阈值是否过高（默认 0.7）
2. 降低阈值: `--threshold 0.6`
3. 检查嵌入模型是否合适

详见: [search_algorithms.md](references/search_algorithms.md) 的算法说明。

## 配置选项

修改 `assets/config/retriever_config.json` 自定义行为：

```json
{
  "search_modes": {
    "keyword": { "default": true },
    "semantic": { "threshold": 0.7 },
    "hybrid": { "keyword_weight": 0.3 }
  },
  "output_format": {
    "max_results": 10,
    "show_snippets": true
  },
  "performance": {
    "enable_indexing": true,
    "enable_caching": true
  }
}
```

## 故障排查

### 问题: 搜索结果为空

**检查**:
1. memory 文件夹是否存在
2. 文件格式是否正确
3. 过滤条件是否太严格

**解决方案**:
- 使用 obsidian-bases-memory skill 初始化系统
- 减少过滤条件
- 尝试不同的搜索模式

### 问题: 搜索速度慢

**检查**:
1. 是否启用了索引
2. 结果数量限制是否合理
3. 是否使用了缓存

**解决方案**:
- 启用索引和缓存
- 限制最大结果数
- 使用关键词搜索（更快）

### 问题: 语义搜索不准确

**检查**:
1. 嵌入模型是否合适
2. 相似度阈值是否合适
3. 查询是否清晰

**解决方案**:
- 使用专业嵌入模型
- 调整相似度阈值
- 使用混合搜索

## 最佳实践

1. **选择合适的搜索模式** - 根据查询类型选择
2. **从宽到窄过滤** - 先宽泛，再精确
3. **利用快捷过滤器** - 使用 /today, /important 等
4. **组合使用搜索模式** - 先关键词，再语义
5. **定期索引** - 保持索引更新

详见: [filter_guide.md](references/filter_guide.md) 和 [search_algorithms.md](references/search_algorithms.md)

## 总结

这个 skill 提供了强大的检索功能：

✅ **三种搜索模式** - 关键词、语义、混合
✅ **丰富的过滤条件** - 日期、类型、重要程度、状态、项目
✅ **灵活的排序选项** - 相关性、日期、重要程度
✅ **优化的输出格式** - 简洁、详细、表格
✅ **完整的参考文档** - 算法、过滤、格式

开始使用：
1. 选择搜索模式
2. 输入查询内容
3. 设置过滤条件
4. 查看结果！
