---
name: obsidian-memory-recorder
description: Obsidian 智能记录技能 - 负责将高价值信息持久化保存到 Obsidian Bases 系统。当用户明确要求"记录"、"保存"、"创建笔记"、"会议记录"或使用 /record, /decision 等命令时。当用户在对话中陈述了**个人偏好**（如工具习惯）、**重要事实**、**关键决策**、**项目背景**或**长期规划**时，即使没有包含"记录"一词，也应主动触发。当用户要求"总结刚才的对话"或"整理一下要点"时。触发后，智能分析内容价值，自动推断记录类型（偏好/决策/日志/知识），提取关键字段（标题、标签、重要程度），并调用工具完成写入。
---

# Obsidian 记录技能

## 概述
本技能帮助你快速记录信息到 Obsidian Bases 记忆系统中。你不需要运行任何外部脚本，Agent 会直接处理文件操作。

## 触发条件
- 用户明确要求记录（如 "记录一下"、"保存"、"/record"）。
- 用户陈述了重要的个人偏好、关键决策、项目背景或长期规划。
- 用户要求总结对话并保存。

## 执行流程

当触发本技能时，请严格按照以下步骤执行：

### 第一步：获取标准时间
为了确保记录时间的准确性，请先调用专门的脚本获取当前时间：

1.  **执行命令**: `python scripts/get_time.py`
2.  **解析输出**: 脚本会输出一个 JSON 对象，包含 `date` (YYYY-MM-DD), `time` (HH:MM), `datetime` (YYYY-MM-DD HH:MM)。
    - 示例输出: `{"date": "2026-02-03", "time": "14:30", "datetime": "2026-02-03 14:30", "timestamp": 1770100200}`
3.  **使用变量**: 后续步骤中涉及日期和时间的地方，**必须**使用该脚本返回的值，分别记为 `{Date}`, `{Time}`, `{DateTime}`。

### 第二步：分析与提取
基于用户的输入和对话上下文，智能提取以下信息：

1.  **内容 (Content)**: 核心记录内容。
2.  **类型 (Type)**:
    - `决策`: 涉及选择、决定、采用某方案。
    - `会议记录`: 涉及多人讨论、会议。
    - `学习笔记`: 涉及新知识、技能学习。
    - `用户偏好`: 涉及用户的工作习惯、喜好。
    - `每日日志`: 默认类型。
3.  **标题 (Title)**:
    - 决策类: "决策 - [决策对象]"
    - 会议类: "会议 - [主题]"
    - 其他: 内容的前 20-30 个字或总结性短语。
4.  **标签 (Tags)**: 根据内容推断，如 `#技术`, `#数据库`, `#决策`, `#Obsidian`。
5.  **重要程度 (Importance)**: 1-5 星。
    - 决策/重要/紧急: 4-5 星
    - 学习/完成: 3 星
    - 默认: 3 星
6.  **项目 (Project)**: (可选) 相关的项目名称。

### 第三步：写入文件
分析完成后，**直接执行**文件写入操作（无需请求用户确认）：

1.  **确定目标文件**:
    - 路径: `memory/{Date}.md` (使用脚本获取的 `Date`)。
    - *注意*: 确保使用绝对路径，通常为 `d:\JF\Note\test-memory-system\memory\{Date}.md`。

2.  **检查与读取**:
    - 检查文件是否存在。
    - **如果文件不存在**:
        - 准备创建新文件。
        - 构造包含完整 Frontmatter 的新内容。
    - **如果文件已存在**:
        - **必须先读取**文件的完整内容。
        - **更新 Frontmatter**:
            - 解析现有的 `tags` 列表。
            - 将本次新记录的 `[{Tags}]` 与现有标签合并，并去重。
            - 更新 `tags` 字段。
            - 更新 `更新时间` 为 `{DateTime}`。
        - **追加内容**:
            - 在文件末尾添加两个换行符。
            - 拼接“追加内容块”。

3.  **构建写入内容**:
    - **Frontmatter 模板** (注意去除缩进):
      ```markdown
      ---
      日期: {Date}
      时间: "{Time}"
      类型: "{Type}"
      标题: "{Title}"
      tags: [{MergedTags}]
      重要程度: {Importance}
      项目: "{Project}"
      状态: "进行中"
      更新时间: {DateTime}
      ---
      ```
    - **追加内容块**:
      ```markdown
      
      ## {Time} - {Title}
      
      {Content}
      
      ---
      ```

4.  **执行写入**:
    - 将构建好的**完整新内容**（含更新后的 Frontmatter 和所有正文）写入文件。
    - 使用 `Write` 工具完成操作（`Write` 会覆盖原文件，所以必须写入完整内容）。

### 第四步：同步核心记忆 (仅特定类型)
如果记录类型为 **`决策`** 或 **`用户偏好`**，请额外执行以下操作：

1.  **读取 `MEMORY.md`**: 路径通常为 `d:\JF\Note\test-memory-system\MEMORY.md`。
2.  **更新内容**:
    - **用户偏好**: 找到 `## 用户偏好` 章节。如果在列表末尾添加 `- {Title} (来源于 [[memory/{Date}.md]])`。如果找不到该章节，请在文件末尾创建它。
    - **决策**: 找到 `## 重要决策历史` 章节，添加二级标题或列表项记录该决策及日期。如果找不到该章节，请在文件末尾创建它。
3.  **写回 `MEMORY.md`**: 使用 `Write` 工具保存更改。

### 第五步：反馈
告知用户记录已完成，并提供文件链接。
例如: `✅ 记录已保存到 [[memory/2026-02-03.md]]`

## 快捷命令参考
- `/d` 或 `/decision`: 强制设为决策类型。
- `/m` 或 `/meeting`: 强制设为会议记录类型。
- `/l` 或 `/learn`: 强制设为学习笔记类型。

## 配置说明
本技能目前直接使用上述规则进行推断。`assets/config/recorder_config.json` 文件不再被自动读取。如需修改推断规则（如关键词、重要程度），请直接编辑本文件 (`SKILL.md`) 中的相关描述。
